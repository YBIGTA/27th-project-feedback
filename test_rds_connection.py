#!/usr/bin/env python3
"""
RDS ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
"""

import os
import sys
from dotenv import load_dotenv

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ë¥¼ Python ê²½ë¡œì— ì¶”ê°€
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

def test_rds_connection():
    """RDS ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤."""
    try:
        from backend.database import test_db_connection
        return test_db_connection()
    except ImportError as e:
        print(f"âŒ ëª¨ë“ˆ import ì‹¤íŒ¨: {e}")
        print("í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”.")
        return False
    except Exception as e:
        print(f"âŒ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜: {e}")
        return False

def check_environment_variables():
    """í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤."""
    required_vars = ['DB_HOST', 'DB_USER', 'DB_PASSWORD', 'DB_NAME']
    missing_vars = []
    
    print("ğŸ” í™˜ê²½ ë³€ìˆ˜ í™•ì¸ ì¤‘...")
    
    for var in required_vars:
        value = os.getenv(var)
        if value:
            # ë¹„ë°€ë²ˆí˜¸ëŠ” ë§ˆìŠ¤í‚¹í•˜ì—¬ í‘œì‹œ
            if var == 'DB_PASSWORD':
                masked_value = '*' * min(len(value), 8)
                print(f"  âœ… {var}: {masked_value}")
            else:
                print(f"  âœ… {var}: {value}")
        else:
            print(f"  âŒ {var}: ì„¤ì •ë˜ì§€ ì•ŠìŒ")
            missing_vars.append(var)
    
    if missing_vars:
        print(f"\nâš ï¸  ë‹¤ìŒ í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤: {', '.join(missing_vars)}")
        print("   .env íŒŒì¼ì„ í™•ì¸í•˜ê±°ë‚˜ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•˜ì„¸ìš”.")
        return False
    
    print("\nâœ… ëª¨ë“  í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.")
    return True

def main():
    """ë©”ì¸ í•¨ìˆ˜"""
    print("ğŸš€ RDS ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹œì‘\n")
    
    # í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
    load_dotenv()
    
    # í™˜ê²½ ë³€ìˆ˜ í™•ì¸
    if not check_environment_variables():
        print("\nâŒ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
        print("RDS_SETUP.md íŒŒì¼ì„ ì°¸ê³ í•˜ì—¬ ì„¤ì •ì„ ì™„ë£Œí•˜ì„¸ìš”.")
        return
    
    print("\nğŸ”Œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...")
    
    # ì—°ê²° í…ŒìŠ¤íŠ¸
    if test_rds_connection():
        print("\nğŸ‰ RDS ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì´ ì„±ê³µì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!")
        print("ì´ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
    else:
        print("\nğŸ’¥ RDS ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")
        print("ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:")
        print("  1. RDS ì¸ìŠ¤í„´ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸")
        print("  2. ë³´ì•ˆ ê·¸ë£¹ì—ì„œ í¬íŠ¸ 3306ì´ ì—´ë ¤ìˆëŠ”ì§€ í™•ì¸")
        print("  3. ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸")
        print("  4. ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸")

if __name__ == "__main__":
    main()
